\hypertarget{md___users_flavio_tmp_documentation-update__h_elib_utils__r_e_a_d_m_e_autotoc_md35}{}\doxysection{Introduction}\label{md___users_flavio_tmp_documentation-update__h_elib_utils__r_e_a_d_m_e_autotoc_md35}
The {\ttfamily utils} directory provides utilities to make using and developing projects in HE simpler for everyone. The utility programs currently should be considered at an alpha state and not completely stable in terms of the C\+LI or all possible configurations.\hypertarget{md___users_flavio_tmp_documentation-update__h_elib_utils__r_e_a_d_m_e_autotoc_md36}{}\doxysection{What is provided}\label{md___users_flavio_tmp_documentation-update__h_elib_utils__r_e_a_d_m_e_autotoc_md36}
Currently the utilities provided comprise\+:
\begin{DoxyItemize}
\item create-\/context
\item encrypt
\item decrypt
\end{DoxyItemize}

More utilities are expected to be released at a later date.

When developing HE programs the encoding is of utmost importance and usually are specific to the problem domain. We provide two simple example programs for encoding and decoding\+:


\begin{DoxyItemize}
\item example encoder (requires python $>$= 3.\+6)
\item example decoder (requires python $>$= 3.\+6)
\end{DoxyItemize}

These example programs are used in our testing. We used Python, however, encoders and decoders programs can be implemented in whatever language the developer wishes.

Some example data can be generated by the example data generation script {\ttfamily gen-\/data.\+py} which can be found in the {\ttfamily tests} directory.\hypertarget{md___users_flavio_tmp_documentation-update__h_elib_utils__r_e_a_d_m_e_autotoc_md37}{}\doxysection{Installation}\label{md___users_flavio_tmp_documentation-update__h_elib_utils__r_e_a_d_m_e_autotoc_md37}
To compile the utilities, you must have H\+Elib already installed on your system (see ../\+I\+N\+S\+T\+A\+LL.md \char`\"{}\+I\+N\+S\+T\+A\+L\+L.\+md\char`\"{} in this distribution\textquotesingle{}s root directory). The process is pure C\+Make. First, create a build directory and move into it. Second, run C\+Make,


\begin{DoxyCode}{0}
\DoxyCodeLine{cmake [-\/Dhelib\_DIR=<directory-\/to-\/installed-\/HElib>/share/cmake/helib] <directory-\/to-\/utils>}
\end{DoxyCode}


then run make from the same directory with optional number of threads using the {\ttfamily -\/j} flag for example,


\begin{DoxyCode}{0}
\DoxyCodeLine{make [-\/j<number-\/of-\/threads>]}
\end{DoxyCode}


The create-\/context, encrypt and decrypt utility executables can be found in the {\ttfamily bin} directory. The example encoder and decoder are found in a separate directory in {\ttfamily $<$directory-\/to-\/utils$>$/coders}.\hypertarget{md___users_flavio_tmp_documentation-update__h_elib_utils__r_e_a_d_m_e_autotoc_md38}{}\doxysection{Running the utilities}\label{md___users_flavio_tmp_documentation-update__h_elib_utils__r_e_a_d_m_e_autotoc_md38}
All utilities have a help method by passing the {\ttfamily -\/h} flag, for example


\begin{DoxyCode}{0}
\DoxyCodeLine{./encrypt -\/h}
\end{DoxyCode}


Below is an example of a basic pipeline for the utilities. For simplicity we shall be using the B\+GV scheme although the utilities also provide C\+K\+KS functionality.


\begin{DoxyEnumerate}
\item Create a parameter file for the B\+GV scheme such as 
\begin{DoxyCode}{0}
\DoxyCodeLine{p=2}
\DoxyCodeLine{m=3}
\DoxyCodeLine{r=1}
\DoxyCodeLine{c=2}
\DoxyCodeLine{Qbits=10}
\end{DoxyCode}

\item Create the context using the previously generated parameter file 
\begin{DoxyCode}{0}
\DoxyCodeLine{./bin/create-\/context <parameter-\/file> -\/-\/info-\/file -\/o example}
\end{DoxyCode}

\end{DoxyEnumerate}

The flag {\ttfamily -\/o} defines the prefix of the files generated by this script. If not specified then the script will generate a prefix using the name of the parameter file by default concatenated with a generated number. This file prefix will be printed to the command line.

The script will always generate two files ({\ttfamily example.\+pk} and {\ttfamily example.\+sk}. They both hold the serialization of the context and the public key and secret key respectively.

The flag {\ttfamily -\/-\/info-\/file} will redirect the information describing the algebra to the file {\ttfamily example.\+info}. By default this information is sent to the standard output however generating the info file is useful for passing to the example encode decode utilities.


\begin{DoxyEnumerate}
\item Encode some data 
\begin{DoxyCode}{0}
\DoxyCodeLine{../coders/encode.py <data-\/file> example.info <scheme> > example.encoded}
\end{DoxyCode}

\end{DoxyEnumerate}

This script reads in data from {\ttfamily $<$data-\/file$>$} where the first line represents the number of lines to read in and each subsequent line contains the coefficients of each slot of the plaintext.

The encoder reads the algebra from the info file {\ttfamily example.\+info} to encode the data in the correct format.

The encoder must also be told which scheme is being used, currently scheme can be either {\ttfamily B\+GV} or {\ttfamily C\+K\+KS}.

The example encoder outputs the encoded data as plaintexts to the command line by default which is then redirected to {\ttfamily example.\+encoded}.

The output of the encoder is a collection of plaintexts and must be formatted as follows\+:

The first line contains the number of plaintexts outputted by the encoder. Each subsequent line contains a single plaintext.

Each plaintext has to be formatted as a comma-\/separated list surrounded by \textquotesingle{}\mbox{[}\textquotesingle{} and \textquotesingle{}\mbox{]}\textquotesingle{}. Each element of the list represents the slot of the plaintext formatted as a comma-\/separated list surrounded by \textquotesingle{}\mbox{[}\textquotesingle{} and \textquotesingle{}\mbox{]}\textquotesingle{}. Each element in the nested list represents the coefficient of the polynomial in the slot. Note, for the C\+K\+KS scheme, there are always a maximum of two elements in a slot of a plaintext which represent the real and imaginary values respectively.

An example output of encoding two plaintexts with three slots, each containing two coefficients is shown below 
\begin{DoxyCode}{0}
\DoxyCodeLine{2}
\DoxyCodeLine{[[0, 1], [2, 3], [4, 5]]}
\DoxyCodeLine{[[6, 7], [8, 9], [10, 11]]}
\end{DoxyCode}


Note that the encoder reads in each line and encodes the values into a slot until the maximum number of slots is reached. When this happens the encoder begins encoding another plaintext until all data values are read in. If the maximum number of slots is not reached upon reaching the end of the data file, then the remaining slots of the plaintext are padded with slots containing 0.


\begin{DoxyEnumerate}
\item Encrypt the data 
\begin{DoxyCode}{0}
\DoxyCodeLine{./bin/encrypt example.pk example.encoded -\/o example.ctxt}
\end{DoxyCode}

\end{DoxyEnumerate}

The encrypt script reads in a public key file {\ttfamily example.\+pk} and some encoded data {\ttfamily example.\+encoded}.

Optionally, the use of {\ttfamily -\/o} enables the user to specify the filename containing the encrypted output. By default the script generates a file using the prefix of the plaintext file and appending the extension {\ttfamily .ctxt}.


\begin{DoxyEnumerate}
\item Decrypt the data 
\begin{DoxyCode}{0}
\DoxyCodeLine{./bin/decrypt example.sk example.ctxt -\/o example.decrypted}
\end{DoxyCode}

\end{DoxyEnumerate}

The decrypt script reads in a secret key file {\ttfamily example.\+sk} and some encrypted data {\ttfamily example.\+ctxt}.

Optionally, the use of {\ttfamily -\/o} enables the user to specify the filename containing the decrypted output. By default the script will print the decrypted plaintext to the standard output.


\begin{DoxyEnumerate}
\item Decode the data 
\begin{DoxyCode}{0}
\DoxyCodeLine{../coders/encode.py example.decrypted example.info <scheme>}
\end{DoxyCode}

\end{DoxyEnumerate}

The decoder reads some encoded data {\ttfamily example.\+decrypted} and an info file {\ttfamily example.\+info} to ensure the data is decoded in the correct format.

The decoder must be told which scheme is being used, currently the scheme can be either {\ttfamily B\+GV} or {\ttfamily C\+K\+KS}.

The input of decoder must be formatted in the same way as the output of the encoder as described above in step 3.

The example decoder outputs the decoded data to the standard output by default.\hypertarget{md___users_flavio_tmp_documentation-update__h_elib_utils__r_e_a_d_m_e_autotoc_md39}{}\doxysection{Running the tests}\label{md___users_flavio_tmp_documentation-update__h_elib_utils__r_e_a_d_m_e_autotoc_md39}
All tests for the utilities are written in bats (a test framework for bash) and requires \href{https://github.com/bats-core/bats-core}{\texttt{ bats-\/core}}.

Note that the tests require that the utilities have been successfully compiled in the {\ttfamily build} directory and available in {\ttfamily build/bin}. To run the tests, one can simply execute the scripts from within the {\ttfamily utils/tests} directory.

To run all tests type the command below. Optionally, the {\ttfamily -\/j} flag can use threads to parallelize the tests. Note, this requires G\+NU parallel, see the \href{https://github.com/bats-core/bats-core}{\texttt{ bats}} documentation for more information. 
\begin{DoxyCode}{0}
\DoxyCodeLine{bats . [-\/j <number-\/of-\/threads>]}
\end{DoxyCode}


To run a specific test file. 
\begin{DoxyCode}{0}
\DoxyCodeLine{bats <testfile> [-\/j <number-\/of-\/threads>]}
\end{DoxyCode}


or 
\begin{DoxyCode}{0}
\DoxyCodeLine{./<testfile> [-\/j <number-\/of-\/threads>]}
\end{DoxyCode}


To run a specific test by name add the {\ttfamily -\/f} flag e.\+g. 
\begin{DoxyCode}{0}
\DoxyCodeLine{bats . -\/f <testname> [-\/j <number-\/of-\/threads>]}
\end{DoxyCode}


The {\ttfamily $<$testname$>$} can be a substring of the test name and will match all valid matches.

For debugging, it is sometimes useful to view the artifacts generated by the tests. For this, set the environment variable {\ttfamily D\+E\+B\+UG} to {\ttfamily true} or {\ttfamily 1} such as, 
\begin{DoxyCode}{0}
\DoxyCodeLine{DEBUG=1 bats . [-\/j <number-\/of-\/threads>]}
\end{DoxyCode}
 